==========================================
SLURM_JOB_ID = 27798558
SLURM_JOB_NODELIST = a03-01
TMPDIR = /tmp/SLURM_27798558
==========================================
Requirement already satisfied: accelerate==1.1.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 1)) (1.1.1)
Requirement already satisfied: aiohappyeyeballs==2.4.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 2)) (2.4.3)
Requirement already satisfied: aiohttp==3.11.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 3)) (3.11.2)
Requirement already satisfied: aiosignal==1.3.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 4)) (1.3.1)
Requirement already satisfied: attrs==24.2.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 5)) (24.2.0)
Requirement already satisfied: bitsandbytes==0.42.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 6)) (0.42.0)
Requirement already satisfied: certifi==2024.8.30 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 7)) (2024.8.30)
Requirement already satisfied: charset-normalizer==3.4.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 8)) (3.4.0)
Requirement already satisfied: datasets==3.1.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 9)) (3.1.0)
Requirement already satisfied: dill==0.3.8 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 10)) (0.3.8)
Requirement already satisfied: einops==0.8.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 11)) (0.8.0)
Requirement already satisfied: filelock==3.16.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 12)) (3.16.1)
Requirement already satisfied: frozenlist==1.5.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 13)) (1.5.0)
Requirement already satisfied: fsspec==2024.9.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 14)) (2024.9.0)
Requirement already satisfied: huggingface-hub==0.26.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 15)) (0.26.2)
Requirement already satisfied: idna==3.10 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 16)) (3.10)
Requirement already satisfied: Jinja2==3.1.4 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 17)) (3.1.4)
Requirement already satisfied: MarkupSafe==3.0.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 18)) (3.0.2)
Requirement already satisfied: mpmath==1.3.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 19)) (1.3.0)
Requirement already satisfied: multidict==6.1.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 20)) (6.1.0)
Requirement already satisfied: multiprocess==0.70.16 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 21)) (0.70.16)
Requirement already satisfied: networkx==3.4.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 22)) (3.4.2)
Requirement already satisfied: numpy==2.1.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 23)) (2.1.3)
Requirement already satisfied: nvidia-cublas-cu12==12.1.3.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 24)) (12.1.3.1)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 25)) (12.1.105)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 26)) (12.1.105)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 27)) (12.1.105)
Requirement already satisfied: nvidia-cudnn-cu12==9.1.0.70 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 28)) (9.1.0.70)
Requirement already satisfied: nvidia-cufft-cu12==11.0.2.54 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 29)) (11.0.2.54)
Requirement already satisfied: nvidia-curand-cu12==10.3.2.106 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 30)) (10.3.2.106)
Requirement already satisfied: nvidia-cusolver-cu12==11.4.5.107 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 31)) (11.4.5.107)
Requirement already satisfied: nvidia-cusparse-cu12==12.1.0.106 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 32)) (12.1.0.106)
Requirement already satisfied: nvidia-nccl-cu12==2.20.5 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 33)) (2.20.5)
Requirement already satisfied: nvidia-nvjitlink-cu12==12.4.127 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 34)) (12.4.127)
Requirement already satisfied: nvidia-nvtx-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 35)) (12.1.105)
Requirement already satisfied: packaging==24.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 36)) (24.2)
Requirement already satisfied: pandas==2.2.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 37)) (2.2.3)
Requirement already satisfied: peft==0.13.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 38)) (0.13.2)
Requirement already satisfied: propcache==0.2.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 39)) (0.2.0)
Requirement already satisfied: psutil==6.1.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 40)) (6.1.0)
Requirement already satisfied: pyarrow==18.0.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 41)) (18.0.0)
Requirement already satisfied: python-dateutil==2.9.0.post0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 42)) (2.9.0.post0)
Requirement already satisfied: pytz==2024.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 43)) (2024.2)
Requirement already satisfied: PyYAML==6.0.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 44)) (6.0.2)
Requirement already satisfied: regex==2024.11.6 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 45)) (2024.11.6)
Requirement already satisfied: requests==2.32.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 46)) (2.32.3)
Requirement already satisfied: safetensors==0.4.5 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 47)) (0.4.5)
Requirement already satisfied: setuptools==75.3.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 48)) (75.3.0)
Requirement already satisfied: six==1.16.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 49)) (1.16.0)
Requirement already satisfied: sympy==1.13.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 50)) (1.13.1)
Requirement already satisfied: tokenizers==0.20.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 51)) (0.20.3)
Requirement already satisfied: torch==2.4.1 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 52)) (2.4.1)
Requirement already satisfied: tqdm==4.67.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 53)) (4.67.0)
Requirement already satisfied: transformers==4.46.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 54)) (4.46.2)
Requirement already satisfied: triton==3.0.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 55)) (3.0.0)
Requirement already satisfied: typing_extensions==4.12.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 56)) (4.12.2)
Requirement already satisfied: tzdata==2024.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 57)) (2024.2)
Requirement already satisfied: urllib3==2.2.3 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 58)) (2.2.3)
Requirement already satisfied: xxhash==3.5.0 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 59)) (3.5.0)
Requirement already satisfied: yarl==1.17.2 in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 60)) (1.17.2)
Requirement already satisfied: scipy in ./venv/lib/python3.12/site-packages (from bitsandbytes==0.42.0->-r requirements.txt (line 6)) (1.14.1)

[notice] A new release of pip is available: 24.0 -> 24.3.1
[notice] To update, run: pip install --upgrade pip
Requirement already satisfied: flash-attn in ./venv/lib/python3.12/site-packages (2.7.0.post2)
Requirement already satisfied: torch in ./venv/lib/python3.12/site-packages (from flash-attn) (2.4.1)
Requirement already satisfied: einops in ./venv/lib/python3.12/site-packages (from flash-attn) (0.8.0)
Requirement already satisfied: filelock in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (3.16.1)
Requirement already satisfied: typing-extensions>=4.8.0 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (4.12.2)
Requirement already satisfied: sympy in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (1.13.1)
Requirement already satisfied: networkx in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (3.4.2)
Requirement already satisfied: jinja2 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (3.1.4)
Requirement already satisfied: fsspec in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (2024.9.0)
Requirement already satisfied: setuptools in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (75.3.0)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.105)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.105)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.105)
Requirement already satisfied: nvidia-cudnn-cu12==9.1.0.70 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (9.1.0.70)
Requirement already satisfied: nvidia-cublas-cu12==12.1.3.1 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.3.1)
Requirement already satisfied: nvidia-cufft-cu12==11.0.2.54 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (11.0.2.54)
Requirement already satisfied: nvidia-curand-cu12==10.3.2.106 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (10.3.2.106)
Requirement already satisfied: nvidia-cusolver-cu12==11.4.5.107 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (11.4.5.107)
Requirement already satisfied: nvidia-cusparse-cu12==12.1.0.106 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.0.106)
Requirement already satisfied: nvidia-nccl-cu12==2.20.5 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (2.20.5)
Requirement already satisfied: nvidia-nvtx-cu12==12.1.105 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (12.1.105)
Requirement already satisfied: triton==3.0.0 in ./venv/lib/python3.12/site-packages (from torch->flash-attn) (3.0.0)
Requirement already satisfied: nvidia-nvjitlink-cu12 in ./venv/lib/python3.12/site-packages (from nvidia-cusolver-cu12==11.4.5.107->torch->flash-attn) (12.4.127)
Requirement already satisfied: MarkupSafe>=2.0 in ./venv/lib/python3.12/site-packages (from jinja2->torch->flash-attn) (3.0.2)
Requirement already satisfied: mpmath<1.4,>=1.1.0 in ./venv/lib/python3.12/site-packages (from sympy->torch->flash-attn) (1.3.0)

[notice] A new release of pip is available: 24.0 -> 24.3.1
[notice] To update, run: pip install --upgrade pip
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:04<00:09,  4.64s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:08<00:04,  4.44s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:13<00:00,  4.30s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:13<00:00,  4.36s/it]
Map:   0%|          | 0/2636 [00:00<?, ? examples/s]Map:  38%|███▊      | 1000/2636 [00:03<00:05, 316.58 examples/s]Map:  76%|███████▌  | 2000/2636 [00:06<00:02, 314.83 examples/s]Map: 100%|██████████| 2636/2636 [00:08<00:00, 313.26 examples/s]Map: 100%|██████████| 2636/2636 [00:08<00:00, 313.56 examples/s]
Detected kernel version 3.10.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
  0%|          | 0/2636 [00:00<?, ?it/s]/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/torch/_dynamo/eval_frame.py:600: UserWarning: torch.utils.checkpoint: the use_reentrant parameter should be passed explicitly. In version 2.4 we will raise an exception if use_reentrant is not passed. use_reentrant=False is recommended, but if you need to preserve the current default behavior, you can pass use_reentrant=True. Refer to docs for more details on the differences between the two variants.
  return fn(*args, **kwargs)
The input hidden states seems to be silently casted in float32, this might be related to the fact you have upcasted embedding or layer norm layers in float32. We will cast back the input in torch.float16.
/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/torch/utils/checkpoint.py:295: FutureWarning: `torch.cpu.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cpu', args...)` instead.
  with torch.enable_grad(), device_autocast_ctx, torch.cpu.amp.autocast(**ctx.cpu_autocast_kwargs):  # type: ignore[attr-defined]
  0%|          | 1/2636 [00:12<9:20:50, 12.77s/it]                                                    0%|          | 1/2636 [00:12<9:20:50, 12.77s/it]{'loss': 2.5677, 'grad_norm': 1.2942122220993042, 'learning_rate': 4.998103186646434e-06, 'epoch': 0.0}
Traceback (most recent call last):
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/finetune.py", line 128, in <module>
    main()
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/finetune.py", line 122, in main
    trainer.train()
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/transformers/trainer.py", line 2123, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/transformers/trainer.py", line 2481, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/transformers/trainer.py", line 3579, in training_step
    loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/transformers/trainer.py", line 3633, in compute_loss
    outputs = model(**inputs)
              ^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 823, in forward
    return model_forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 811, in __call__
    return convert_to_fp32(self.model_forward(*args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 790, in convert_to_fp32
    return recursively_apply(_convert_to_fp32, tensor, test_type=_is_fp16_bf16_tensor)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 120, in recursively_apply
    k: recursively_apply(
       ^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 127, in recursively_apply
    return func(data, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/swabhas_1457/ctli/cm/544-nlp-project/official_finetuning/venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 782, in _convert_to_fp32
    return tensor.float()
           ^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 3.00 GiB. GPU 0 has a total capacity of 44.35 GiB of which 1.57 GiB is free. Including non-PyTorch memory, this process has 42.77 GiB memory in use. Of the allocated memory 33.03 GiB is allocated by PyTorch, and 9.42 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
  0%|          | 1/2636 [00:16<12:14:20, 16.72s/it]
